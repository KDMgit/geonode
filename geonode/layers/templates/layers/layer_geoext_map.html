{% include "geonode/ext_header.html" %} 
{% include "geonode/app_header.html" %} 
{% include "geonode/geo_header.html" %} 
{% include "geonode/ocd_header.html" %}

<script type="text/javascript">
var foobar = {};
{% autoescape off %}
        var styleEditor, modified = false;
        Ext.onReady(function() {
            var config = {
           		tools: [
           		    {
           		    	ptype: "gxp_tool",
           		    	actions : [
     		    	           new Ext.Button({
     		    	        	  text : "ciao",
     		    	        	  handler : function(){
     		    	        		  
     		    	        	  }
     		    	           })
           		    	]
           		    },
					{
					    ptype: "gxp_zoomtolayerextent",
					    listeners : {
					    	activate : function(){
					    	}
					    }
					},
	                {
	                    ptype: "gxp_featuremanager",
	                    id: "states_manager",
	                    paging: false,
	                    autoSetLayer: true
	                },
	                {
	                    ptype: "gxp_featureeditor",
	                    featureManager: "states_manager",
	                    autoLoadFeature: true
	                },
	                {
            			ptype : 'gxp_layermanager',
            			id : "layermanager",
           				actions : [
         		    	           { 
         		    	        	   ptype : "button" 
         		    	        	}
               		    	]
            		}, {
            			hidden : true,
            			actions : [ '-' ]
            		}, {
            			ptype : 'gxp_print',
            			customParams : {
            				outputFilename : 'GeoExplorer-print'
            			},
            			printService : '{{GEOSERVER_BASE_URL}}pdf/'
            		}, {
            			
            			ptype : 'gxp_navigation',
            			toggleGroup : 'navigation'
            		}, {
            			
            			ptype : 'gxp_wmsgetfeatureinfo',
            			format : 'grid',
            			toggleGroup : 'interaction'
            		}, {
            			ptype : 'gxp_measure',
            			controlOptions : {
            				immediate : true
            			},
            			toggleGroup : 'interaction'
            		}, {
            			ptype : 'gxp_zoom'
            		}, {
            			ptype : 'gxp_navigationhistory'
            		}, {
            			ptype : 'gxp_zoomtoextent'
            		},{
            			ptype : 'gxp_googleearth'
            		}, 
            	],
            		
                proxy: "/proxy/?url=",
                localGeoServerBaseUrl: "{{GEOSERVER_BASE_URL}}",
                authorizedRoles: "{{ user.is_authenticated|yesno:"ROLE_ADMINISTRATOR,ROLE_ANONYMOUS" }}",

                /* The URL to a REST map configuration service.  This service 
                 * provides listing and, with an authenticated user, saving of 
                 * maps on the server for sharing and editing.
                 */
                rest: "/maps/",
                printService: "{{GEOSERVER_BASE_URL}}pdf/",
                
                portalConfig: {
                    renderTo: "preview_map",
                    height: 400 
                },

                listeners: {
                    "portalready" : function(){
                    	/*
                         * After GeoExplorer has started apply our plugin to the toolbar
                         */
                    	OCD.plugToolbar(app.mapPanel.topToolbar);
                    },
                    "ready": function() {
                        var map = app.mapPanel.map;
                        map.zoomToExtent(map.layers.slice(-2)[0].maxExtent);
                        
                        /*
                         * After GeoExplorer has started apply our plugin to the layers
                         */
                        OCD.plugLayers(app);
                    },
                    "beforeunload": function() {
                        if (modified) {
                            styleEditor.show();
                            return false;
                        }
                    }
                }
            };
            
            config = Ext.apply(config, {{ viewer|safe }});
            
            app = new gxp.Viewer(config);



        });
    {% endautoescape %}
    </script>
